var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},r=e.parcelRequire4485;null==r&&((r=function(e){if(e in t)return t[e].exports;if(e in n){var r=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,r.call(o.exports,o,o.exports),o.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},e.parcelRequire4485=r);var o=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function r(n){for(var r=0;r<t.children.length;r++)t.children[r].style.display=r===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),r(++e%t.children.length)}),!1);var i=(performance||Date).now(),s=i,a=0,l=n(new o.Panel("FPS","#0ff","#002")),c=n(new o.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var d=n(new o.Panel("MB","#f08","#201"));return r(0),{REVISION:16,dom:t,addPanel:n,showPanel:r,begin:function(){i=(performance||Date).now()},end:function(){a++;var e=(performance||Date).now();if(c.update(e-i,200),e>s+1e3&&(l.update(1e3*a/(e-s),100),s=e,a=0,d)){var t=performance.memory;d.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:r}};o.Panel=function(e,t,n){var r=1/0,o=0,i=Math.round,s=i(window.devicePixelRatio||1),a=80*s,l=48*s,c=3*s,d=2*s,u=3*s,p=15*s,f=74*s,h=30*s,m=document.createElement("canvas");m.width=a,m.height=l,m.style.cssText="width:80px;height:48px";var y=m.getContext("2d");return y.font="bold "+9*s+"px Helvetica,Arial,sans-serif",y.textBaseline="top",y.fillStyle=n,y.fillRect(0,0,a,l),y.fillStyle=t,y.fillText(e,c,d),y.fillRect(u,p,f,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u,p,f,h),{dom:m,update:function(l,w){r=Math.min(r,l),o=Math.max(o,l),y.fillStyle=n,y.globalAlpha=1,y.fillRect(0,0,a,p),y.fillStyle=t,y.fillText(i(l)+" "+e+" ("+i(r)+"-"+i(o)+")",c,d),y.drawImage(m,u+s,p,f-s,h,u,p,f-s,h),y.fillRect(u+f-s,p,s,h),y.fillStyle=n,y.globalAlpha=.9,y.fillRect(u+f-s,p,s,i((1-l/w)*h))}}};var i=r("ilwiq"),s=r("5Rd1x");const a=new((i=r("ilwiq")).Color);class l extends i.Loader{constructor(e){super(e),this.propertyNameMapping={}}load(e,t,n,r){const o=this,s=new i.FileLoader(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(e,(function(n){try{t(o.parse(n))}catch(t){r?r(t):console.error(t),o.manager.itemError(e)}}),n,r)}setPropertyNameMapping(e){this.propertyNameMapping=e}parse(e){function t(e){let t="",n=0;const r=/^ply([\s\S]*)end_header(\r\n|\r|\n)/.exec(e);null!==r&&(t=r[1],n=new Blob([r[0]]).size);const o={comments:[],elements:[],headerLength:n,objInfo:""},i=t.split(/\r\n|\r|\n/);let s;function a(e,t){const n={type:e[0]};return"list"===n.type?(n.name=e[3],n.countType=e[1],n.itemType=e[2]):n.name=e[1],n.name in t&&(n.name=t[n.name]),n}for(let e=0;e<i.length;e++){let t=i[e];if(t=t.trim(),""===t)continue;const n=t.split(/\s+/),r=n.shift();switch(t=n.join(" "),r){case"format":o.format=n[0],o.version=n[1];break;case"comment":o.comments.push(t);break;case"element":void 0!==s&&o.elements.push(s),s={},s.name=n[0],s.count=parseInt(n[1]),s.properties=[];break;case"property":s.properties.push(a(n,p.propertyNameMapping));break;case"obj_info":o.objInfo=t;break;default:console.log("unhandled",r,n)}}return void 0!==s&&o.elements.push(s),o}function n(e,t){switch(t){case"char":case"uchar":case"short":case"ushort":case"int":case"uint":case"int8":case"uint8":case"int16":case"uint16":case"int32":case"uint32":return parseInt(e);case"float":case"double":case"float32":case"float64":return parseFloat(e)}}function r(e,t){const r=t.split(/\s+/),o={};for(let t=0;t<e.length;t++)if("list"===e[t].type){const i=[],s=n(r.shift(),e[t].countType);for(let o=0;o<s;o++)i.push(n(r.shift(),e[t].itemType));o[e[t].name]=i}else o[e[t].name]=n(r.shift(),e[t].type);return o}function o(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]};let o;let i="";null!==(o=/end_header\s([\s\S]*)$/.exec(e))&&(i=o[1]);const a=i.split(/\r\n|\r|\n/);let c=0,d=0;for(let e=0;e<a.length;e++){let o=a[e];if(o=o.trim(),""===o)continue;d>=t.elements[c].count&&(c++,d=0);const i=r(t.elements[c].properties,o);l(n,t.elements[c].name,i),d++}return s(n)}function s(e){let t=new i.BufferGeometry;return e.indices.length>0&&t.setIndex(e.indices),t.setAttribute("position",new i.Float32BufferAttribute(e.vertices,3)),e.normals.length>0&&t.setAttribute("normal",new i.Float32BufferAttribute(e.normals,3)),e.uvs.length>0&&t.setAttribute("uv",new i.Float32BufferAttribute(e.uvs,2)),e.colors.length>0&&t.setAttribute("color",new i.Float32BufferAttribute(e.colors,3)),e.faceVertexUvs.length>0&&(t=t.toNonIndexed(),t.setAttribute("uv",new i.Float32BufferAttribute(e.faceVertexUvs,2))),t.computeBoundingSphere(),t}function l(e,t,n){function r(e){for(let t=0,r=e.length;t<r;t++){const r=e[t];if(r in n)return r}return null}const o=r(["x","px","posx"])||"x",i=r(["y","py","posy"])||"y",s=r(["z","pz","posz"])||"z",l=r(["nx","normalx"]),c=r(["ny","normaly"]),d=r(["nz","normalz"]),u=r(["s","u","texture_u","tx"]),p=r(["t","v","texture_v","ty"]),f=r(["red","diffuse_red","r","diffuse_r"]),h=r(["green","diffuse_green","g","diffuse_g"]),m=r(["blue","diffuse_blue","b","diffuse_b"]);if("vertex"===t)e.vertices.push(n[o],n[i],n[s]),null!==l&&null!==c&&null!==d&&e.normals.push(n[l],n[c],n[d]),null!==u&&null!==p&&e.uvs.push(n[u],n[p]),null!==f&&null!==h&&null!==m&&(a.setRGB(n[f]/255,n[h]/255,n[m]/255).convertSRGBToLinear(),e.colors.push(a.r,a.g,a.b));else if("face"===t){const t=n.vertex_indices||n.vertex_index,r=n.texcoord;3===t.length?(e.indices.push(t[0],t[1],t[2]),r&&6===r.length&&(e.faceVertexUvs.push(r[0],r[1]),e.faceVertexUvs.push(r[2],r[3]),e.faceVertexUvs.push(r[4],r[5]))):4===t.length&&(e.indices.push(t[0],t[1],t[3]),e.indices.push(t[1],t[2],t[3]))}}function c(e,t,n,r){switch(n){case"int8":case"char":return[e.getInt8(t),1];case"uint8":case"uchar":return[e.getUint8(t),1];case"int16":case"short":return[e.getInt16(t,r),2];case"uint16":case"ushort":return[e.getUint16(t,r),2];case"int32":case"int":return[e.getInt32(t,r),4];case"uint32":case"uint":return[e.getUint32(t,r),4];case"float32":case"float":return[e.getFloat32(t,r),4];case"float64":case"double":return[e.getFloat64(t,r),8]}}function d(e,t,n,r){const o={};let i,s=0;for(let a=0;a<n.length;a++)if("list"===n[a].type){const l=[];i=c(e,t+s,n[a].countType,r);const d=i[0];s+=i[1];for(let o=0;o<d;o++)i=c(e,t+s,n[a].itemType,r),l.push(i[0]),s+=i[1];o[n[a].name]=l}else i=c(e,t+s,n[a].type,r),o[n[a].name]=i[0],s+=i[1];return[o,s]}let u;const p=this;if(e instanceof ArrayBuffer){const n=i.LoaderUtils.decodeText(new Uint8Array(e)),r=t(n);u="ascii"===r.format?o(n,r):function(e,t){const n={indices:[],vertices:[],normals:[],uvs:[],faceVertexUvs:[],colors:[]},r="binary_little_endian"===t.format,o=new DataView(e,t.headerLength);let i,a=0;for(let e=0;e<t.elements.length;e++)for(let s=0;s<t.elements[e].count;s++){i=d(o,a,t.elements[e].properties,r),a+=i[1];const s=i[0];l(n,t.elements[e].name,s)}return s(n)}(e,r)}else u=o(e,t(e));return u}}var c=r("jiuw3"),d=r("4CEV9");let u,p,f,h,m,y,w,g;i.Mesh.prototype.raycast=d.acceleratedRaycast,i.BufferGeometry.prototype.computeBoundsTree=d.computeBoundsTree,i.BufferGeometry.prototype.disposeBoundsTree=d.disposeBoundsTree;let x,v=new i.Vector2;const b=new i.Raycaster,T={displayHelper:!1,helperDepth:10,displayParents:!1,strategy:d.CENTER,pointSize:.005,raycastThreshold:.005,useBVH:!0};window.addEventListener("pointermove",(e=>{if(!m)return;v.x=e.clientX/window.innerWidth*2-1,v.y=-e.clientY/window.innerHeight*2+1,b.setFromCamera(v,f);const t=window.performance.now();if(T.useBVH){x.visible=!1;const e=new i.Matrix4;e.copy(m.matrixWorld).invert(),b.ray.applyMatrix4(e);const t=b.params.Points.threshold/((m.scale.x+m.scale.y+m.scale.z)/3),n=t*t,{ray:r}=b;let o=1/0;m.geometry.boundsTree.shapecast({boundsTraverseOrder:e=>e.distanceToPoint(r.origin),intersectsBounds:(e,n,i)=>i>o?d.NOT_INTERSECTED:(e.expandByScalar(t),r.intersectsBox(e)?d.INTERSECTED:d.NOT_INTERSECTED),intersectsTriangle:e=>{if(r.distanceSqToPoint(e.a)<n){const t=r.origin.distanceTo(e.a);t<o&&(o=t,x.position.copy(e.a).applyMatrix4(m.matrixWorld),x.visible=!0)}}})}else{const e=b.intersectObject(w,!0)[0];e?(x.position.copy(e.point),x.visible=!0):x.visible=!1}const n=window.performance.now()-t;g.innerText=`${n.toFixed(2)}ms`}),!1),function(){g=document.getElementById("output"),h=new i.WebGLRenderer({antialias:!0}),h.setPixelRatio(window.devicePixelRatio),h.setSize(window.innerWidth,window.innerHeight),h.setClearColor(1251612,1),document.body.appendChild(h.domElement),p=new i.Scene,f=new i.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,50),f.position.set(3,3,3),f.far=100,f.updateProjectionMatrix(),new s.OrbitControls(f,h.domElement),u=new o,document.body.appendChild(u.dom),window.addEventListener("resize",(function(){f.aspect=window.innerWidth/window.innerHeight,f.updateProjectionMatrix(),h.setSize(window.innerWidth,window.innerHeight)}),!1),(new l).load("../models/point_cloud_porsche_911_1.7M_vertices/scene.ply",(e=>{e.center();const t=new i.PointsMaterial({size:T.pointSize,vertexColors:!0});w=new i.Points(e,t),w.matrixAutoUpdate=!1,p.add(w);const n=[],r=e.clone();for(let e=0,t=r.attributes.position.count;e<t;e++)n.push(e,e,e);r.setIndex(n);const o=new i.MeshBasicMaterial({color:16711680});m=new i.Mesh(r,o),console.time("computeBoundsTree"),m.geometry.computeBoundsTree({mode:T.mode}),console.timeEnd("computeBoundsTree"),y=new d.MeshBVHVisualizer(m,T.depth),p.add(y)}));const e=new i.SphereGeometry(.01,32,32),t=new i.MeshBasicMaterial({color:16776960,opacity:.9,transparent:!0});x=new i.Mesh(e,t),x.visible=!1,p.add(x);const n=new c.GUI,r=n.addFolder("helper");r.add(T,"displayHelper"),r.add(T,"displayParents").onChange((e=>{y.displayParents=e,y.update()})),r.add(T,"helperDepth",1,20,1).name("depth").onChange((e=>{y.depth=parseInt(e),y.update()})),r.open();const a=n.addFolder("points");a.add(T,"useBVH"),a.add(T,"strategy",{CENTER:d.CENTER,AVERAGE:d.AVERAGE,SAH:d.SAH}).onChange((e=>{console.time("computeBoundsTree"),m.geometry.computeBoundsTree({strategy:parseInt(e)}),console.timeEnd("computeBoundsTree"),y.update()})),a.add(T,"pointSize",.001,.01,.001),a.add(T,"raycastThreshold",.001,.01,.001),a.open()}(),function e(){requestAnimationFrame(e),w&&(w.material.size=T.pointSize,y.visible=T.displayHelper,b.params.Points.threshold=T.raycastThreshold),u.begin(),h.render(p,f),u.end()}();
//# sourceMappingURL=pointCloudIntersection.812fc1d5.js.map
